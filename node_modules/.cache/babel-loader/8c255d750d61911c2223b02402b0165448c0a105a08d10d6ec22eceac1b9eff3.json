{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"useIntersection\", {\n  enumerable: true,\n  get: function () {\n    return useIntersection;\n  }\n});\nconst _react = require(\"react\");\nconst _requestidlecallback = require(\"./request-idle-callback\");\nconst hasIntersectionObserver = typeof IntersectionObserver === \"function\";\nconst observers = new Map();\nconst idList = [];\nfunction createObserver(options) {\n  const id = {\n    root: options.root || null,\n    margin: options.rootMargin || \"\"\n  };\n  const existing = idList.find(obj => obj.root === id.root && obj.margin === id.margin);\n  let instance;\n  if (existing) {\n    instance = observers.get(existing);\n    if (instance) {\n      return instance;\n    }\n  }\n  const elements = new Map();\n  const observer = new IntersectionObserver(entries => {\n    entries.forEach(entry => {\n      const callback = elements.get(entry.target);\n      const isVisible = entry.isIntersecting || entry.intersectionRatio > 0;\n      if (callback && isVisible) {\n        callback(isVisible);\n      }\n    });\n  }, options);\n  instance = {\n    id,\n    observer,\n    elements\n  };\n  idList.push(id);\n  observers.set(id, instance);\n  return instance;\n}\nfunction observe(element, callback, options) {\n  const {\n    id,\n    observer,\n    elements\n  } = createObserver(options);\n  elements.set(element, callback);\n  observer.observe(element);\n  return function unobserve() {\n    elements.delete(element);\n    observer.unobserve(element);\n    // Destroy observer when there's nothing left to watch:\n    if (elements.size === 0) {\n      observer.disconnect();\n      observers.delete(id);\n      const index = idList.findIndex(obj => obj.root === id.root && obj.margin === id.margin);\n      if (index > -1) {\n        idList.splice(index, 1);\n      }\n    }\n  };\n}\nfunction useIntersection(param) {\n  let {\n    rootRef,\n    rootMargin,\n    disabled\n  } = param;\n  const isDisabled = disabled || !hasIntersectionObserver;\n  const [visible, setVisible] = (0, _react.useState)(false);\n  const elementRef = (0, _react.useRef)(null);\n  const setElement = (0, _react.useCallback)(element => {\n    elementRef.current = element;\n  }, []);\n  (0, _react.useEffect)(() => {\n    if (hasIntersectionObserver) {\n      if (isDisabled || visible) return;\n      const element = elementRef.current;\n      if (element && element.tagName) {\n        const unobserve = observe(element, isVisible => isVisible && setVisible(isVisible), {\n          root: rootRef == null ? void 0 : rootRef.current,\n          rootMargin\n        });\n        return unobserve;\n      }\n    } else {\n      if (!visible) {\n        const idleCallback = (0, _requestidlecallback.requestIdleCallback)(() => setVisible(true));\n        return () => (0, _requestidlecallback.cancelIdleCallback)(idleCallback);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDisabled, rootMargin, rootRef, visible, elementRef.current]);\n  const resetVisible = (0, _react.useCallback)(() => {\n    setVisible(false);\n  }, []);\n  return [setElement, visible, resetVisible];\n}\nif ((typeof exports.default === 'function' || typeof exports.default === 'object' && exports.default !== null) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', {\n    value: true\n  });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}","map":{"version":3,"names":["useIntersection","hasIntersectionObserver","IntersectionObserver","observers","Map","idList","createObserver","options","id","root","margin","rootMargin","existing","find","obj","instance","get","elements","observer","entries","forEach","entry","callback","target","isVisible","isIntersecting","intersectionRatio","push","set","observe","element","unobserve","delete","size","disconnect","index","findIndex","splice","param","rootRef","disabled","isDisabled","visible","setVisible","_react","useState","elementRef","useRef","setElement","useCallback","current","useEffect","tagName","idleCallback","_requestidlecallback","requestIdleCallback","cancelIdleCallback","resetVisible"],"sources":["../../src/client/use-intersection.tsx"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}