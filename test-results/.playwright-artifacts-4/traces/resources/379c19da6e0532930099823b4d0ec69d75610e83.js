"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[840],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=o,m=c["".concat(l,".").concat(d)]||c[d]||h[d]||a;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8737:function(e,t,n){n.r(t),n.d(t,{assets:function(){return g},contentTitle:function(){return d},default:function(){return f},frontMatter:function(){return h},metadata:function(){return m},toc:function(){return w}});var r=n(3905),o=Object.defineProperty,a=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&u(e,n,t[n]);if(s)for(var n of s(t))p.call(t,n)&&u(e,n,t[n]);return e};const h={id:"ci-intro",title:"CI GitHub Actions"},d=void 0,m={unversionedId:"ci-intro",id:"version-stable/ci-intro",title:"CI GitHub Actions",description:"Introduction",source:"@site/versioned_docs/version-stable/ci-intro.mdx",sourceDirName:".",slug:"/ci-intro",permalink:"/docs/ci-intro",draft:!1,tags:[],version:"stable",frontMatter:{id:"ci-intro",title:"CI GitHub Actions"},sidebar:"docs",previous:{title:"Trace viewer",permalink:"/docs/trace-viewer-intro"},next:{title:"Getting started - VS Code",permalink:"/docs/getting-started-vscode"}},g={},w=[{value:"Introduction",id:"introduction",level:2},{value:"You will learn",id:"you-will-learn",level:4},{value:"Setting up GitHub Actions",id:"setting-up-github-actions",level:2},{value:"On push/pull_request",id:"on-pushpull_request",level:3},{value:"On push/pull_request (sharded)",id:"on-pushpull_request-sharded",level:3},{value:"Via Containers",id:"via-containers",level:3},{value:"On deployment",id:"on-deployment",level:3},{value:"Create a Repo and Push to GitHub",id:"create-a-repo-and-push-to-github",level:2},{value:"Opening the Workflows",id:"opening-the-workflows",level:2},{value:"Viewing Test Logs",id:"viewing-test-logs",level:2},{value:"HTML Report",id:"html-report",level:2},{value:"Downloading the HTML Report",id:"downloading-the-html-report",level:3},{value:"Viewing the HTML Report",id:"viewing-the-html-report",level:3},{value:"Viewing the Trace",id:"viewing-the-trace",level:2},{value:"Publishing report on the web",id:"publishing-report-on-the-web",level:2},{value:"What&#39;s Next",id:"whats-next",level:2}],b={toc:w};function f(e){var t,n=e,{components:o}=n,u=((e,t)=>{var n={};for(var r in e)l.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&s)for(var r of s(e))t.indexOf(r)<0&&p.call(e,r)&&(n[r]=e[r]);return n})(n,["components"]);return(0,r.kt)("wrapper",(t=c(c({},b),u),a(t,i({components:o,mdxType:"MDXLayout"}))),(0,r.kt)("h2",c({},{id:"introduction"}),"Introduction"),(0,r.kt)("p",null,"Playwright tests can be run on any CI provider. In this section we will cover running tests on GitHub using GitHub actions. If you would like to see how to configure other CI providers check out our detailed ",(0,r.kt)("a",c({parentName:"p"},{href:"/docs/ci"}),"doc on Continuous Integration"),"."),(0,r.kt)("p",null,"When ",(0,r.kt)("a",c({parentName:"p"},{href:"/docs/intro"}),"installing Playwright")," using the ",(0,r.kt)("a",c({parentName:"p"},{href:"/docs/getting-started-vscode"}),"VS Code extension")," or with ",(0,r.kt)("inlineCode",{parentName:"p"},"npm init playwright@latest")," you are given the option to add a ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions"}),"GitHub Actions"),". This creates a ",(0,r.kt)("inlineCode",{parentName:"p"},"playwright.yml")," file inside a ",(0,r.kt)("inlineCode",{parentName:"p"},".github/workflows")," folder containing everything you need so that your tests run on each push and pull request into the main/master branch."),(0,r.kt)("h4",c({},{id:"you-will-learn"}),"You will learn"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/ci-intro#on-pushpull_request"}),"How to run tests on push/pull_request")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/ci-intro#viewing-test-logs"}),"How to view test logs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/ci-intro#viewing-the-html-report"}),"How to view the HTML report")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/ci-intro#viewing-the-trace"}),"How to view the trace")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/ci-intro#publishing-report-on-the-web"}),"How to publish report on the web"))),(0,r.kt)("h2",c({},{id:"setting-up-github-actions"}),"Setting up GitHub Actions"),(0,r.kt)("h3",c({},{id:"on-pushpull_request"}),"On push/pull_request"),(0,r.kt)("p",null,"Tests will run on push or pull request on branches main/master. The ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions/using-workflows/about-workflows"}),"workflow")," will install all dependencies, install Playwright and then run the tests. It will also create the HTML report."),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-yml",metastring:'title=".github/workflows/playwright.yml"',title:'".github/workflows/playwright.yml"'}),"name: Playwright Tests\non:\n  push:\n    branches: [ main, master ]\n  pull_request:\n    branches: [ main, master ]\njobs:\n  test:\n    timeout-minutes: 60\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    - uses: actions/setup-node@v3\n      with:\n        node-version: 18\n    - name: Install dependencies\n      run: npm ci\n    - name: Install Playwright Browsers\n      run: npx playwright install --with-deps\n    - name: Run Playwright tests\n      run: npx playwright test\n    - uses: actions/upload-artifact@v3\n      if: always()\n      with:\n        name: playwright-report\n        path: playwright-report/\n        retention-days: 30\n")),(0,r.kt)("h3",c({},{id:"on-pushpull_request-sharded"}),"On push/pull_request (sharded)"),(0,r.kt)("p",null,"GitHub Actions supports ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs"}),"sharding tests between multiple jobs"),". Check out our ",(0,r.kt)("a",c({parentName:"p"},{href:"./test-sharding"}),"sharding doc")," to learn more about sharding and to see a ",(0,r.kt)("a",c({parentName:"p"},{href:"/docs/test-sharding#github-actions-example"}),"GitHub actions example")," of how to configure a job to run your tests on multiple machines as well as how to merge the HTML reports."),(0,r.kt)("h3",c({},{id:"via-containers"}),"Via Containers"),(0,r.kt)("p",null,"GitHub Actions support ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions/using-jobs/running-jobs-in-a-container"}),"running jobs in a container")," by using the ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idcontainer"}),(0,r.kt)("inlineCode",{parentName:"a"},"jobs.<job_id>.container"))," option. This is useful to not pollute the host environment with dependencies and to have a consistent environment for e.g. screenshots/visual regression testing across different operating systems."),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-yml",metastring:'title=".github/workflows/playwright.yml"',title:'".github/workflows/playwright.yml"'}),"name: Playwright Tests\non:\n  push:\n    branches: [ main, master ]\n  pull_request:\n    branches: [ main, master ]\njobs:\n  playwright:\n    name: 'Playwright Tests'\n    runs-on: ubuntu-latest\n    container:\n      image: mcr.microsoft.com/playwright:v1.39.0-jammy\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/setup-node@v3\n        with:\n          node-version: 18\n      - name: Install dependencies\n        run: npm ci\n      - name: Run your tests\n        run: npx playwright test\n")),(0,r.kt)("h3",c({},{id:"on-deployment"}),"On deployment"),(0,r.kt)("p",null,"This will start the tests after a ",(0,r.kt)("a",c({parentName:"p"},{href:"https://developer.github.com/v3/repos/deployments/"}),"GitHub Deployment")," went into the ",(0,r.kt)("inlineCode",{parentName:"p"},"success")," state. Services like Vercel use this pattern so you can run your end-to-end tests on their deployed environment."),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-yml",metastring:'title=".github/workflows/playwright.yml"',title:'".github/workflows/playwright.yml"'}),"name: Playwright Tests\non:\n  deployment_status:\njobs:\n  test:\n    timeout-minutes: 60\n    runs-on: ubuntu-latest\n    if: github.event.deployment_status.state == 'success'\n    steps:\n    - uses: actions/checkout@v3\n    - uses: actions/setup-node@v3\n      with:\n        node-version: 18\n    - name: Install dependencies\n      run: npm ci\n    - name: Install Playwright\n      run: npx playwright install --with-deps\n    - name: Run Playwright tests\n      run: npx playwright test\n      env:\n        PLAYWRIGHT_TEST_BASE_URL: ${{ github.event.deployment_status.target_url }}\n")),(0,r.kt)("h2",c({},{id:"create-a-repo-and-push-to-github"}),"Create a Repo and Push to GitHub"),(0,r.kt)("p",null,"Once you have your ",(0,r.kt)("a",c({parentName:"p"},{href:"#setting-up-github-actions"}),"GitHub actions workflow")," setup then all you need to do is ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/get-started/quickstart/create-a-repo"}),"Create a repo on GitHub")," or push your code to an existing repository. Follow the instructions on GitHub and don't forget to ",(0,r.kt)("a",c({parentName:"p"},{href:"https://github.com/git-guides/git-init"}),"initialize a git repository")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"git init")," command so you can ",(0,r.kt)("a",c({parentName:"p"},{href:"https://github.com/git-guides/git-add"}),"add"),", ",(0,r.kt)("a",c({parentName:"p"},{href:"https://github.com/git-guides/git-commit"}),"commit")," and ",(0,r.kt)("a",c({parentName:"p"},{href:"https://github.com/git-guides/git-push"}),"push")," your code."),(0,r.kt)("img",{width:"861",alt:"Create a Repo and Push to GitHub",src:"https://user-images.githubusercontent.com/13063165/183423254-d2735278-a2ab-4d63-bb99-48d8e5e447bc.png"}),(0,r.kt)("h2",c({},{id:"opening-the-workflows"}),"Opening the Workflows"),(0,r.kt)("p",null,"Click on the ",(0,r.kt)("strong",{parentName:"p"},"Actions")," tab to see the workflows. Here you will see if your tests have passed or failed."),(0,r.kt)("img",{width:"847",alt:"Opening the Workflows",src:"https://user-images.githubusercontent.com/13063165/183423584-2ea18038-cd49-4daa-a20c-2205352f0933.png"}),(0,r.kt)("p",null,"On Pull Requests you can also click on the ",(0,r.kt)("strong",{parentName:"p"},"Details")," link in the ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/collaborating-on-repositories-with-code-quality-features/about-status-checks"}),"PR status check"),"."),(0,r.kt)("img",{width:"645",alt:"pr status checked",src:"https://user-images.githubusercontent.com/13063165/183722462-17a985db-0e10-4205-b16c-8aaac36117b9.png"}),(0,r.kt)("h2",c({},{id:"viewing-test-logs"}),"Viewing Test Logs"),(0,r.kt)("p",null,"Clicking on the workflow run will show you the all the actions that GitHub performed and clicking on ",(0,r.kt)("strong",{parentName:"p"},"Run Playwright tests")," will show the error messages, what was expected and what was received as well as the call log."),(0,r.kt)("img",{width:"839",alt:"Viewing Test Logs",src:"https://user-images.githubusercontent.com/13063165/183423783-58bf2008-514e-4f96-9c12-c9a55703960c.png"}),(0,r.kt)("h2",c({},{id:"html-report"}),"HTML Report"),(0,r.kt)("p",null,"The HTML Report shows you a full report of your tests. You can filter the report by browsers, passed tests, failed tests, skipped tests and flaky tests."),(0,r.kt)("h3",c({},{id:"downloading-the-html-report"}),"Downloading the HTML Report"),(0,r.kt)("p",null,"In the Artifacts section click on the ",(0,r.kt)("strong",{parentName:"p"},"playwright-report")," to download your report in the format of a zip file."),(0,r.kt)("img",{width:"972",alt:"Downloading the HTML Report",src:"https://user-images.githubusercontent.com/13063165/183437023-524f1803-84e4-4862-9ce3-1d55af0e023e.png"}),(0,r.kt)("h3",c({},{id:"viewing-the-html-report"}),"Viewing the HTML Report"),(0,r.kt)("p",null,"Locally opening the report will not work as expected as you need a web server in order for everything to work correctly. First, extract the zip, preferably in a folder that already has Playwright installed. Using the command line change into the directory where the report is and use ",(0,r.kt)("inlineCode",{parentName:"p"},"npx playwright show-report")," followed by the name of the extracted folder. This will serve up the report and enable you to view it in your browser."),(0,r.kt)("pre",null,(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),"npx playwright show-report name-of-my-extracted-playwright-report\n")),(0,r.kt)("p",null,(0,r.kt)("img",c({parentName:"p"},{src:"https://github.com/microsoft/playwright/assets/13063165/c5f60e56-fb75-4a2d-a4b6-054b8c5d69c1",alt:"viewing the HTML report"}))),(0,r.kt)("p",null,"To learn more about reports check out our detailed guide on ",(0,r.kt)("a",c({parentName:"p"},{href:"/docs/test-reporters#html-reporter"}),"HTML Reporter")),(0,r.kt)("h2",c({},{id:"viewing-the-trace"}),"Viewing the Trace"),(0,r.kt)("p",null,"Once you have served the report using ",(0,r.kt)("inlineCode",{parentName:"p"},"npx playwright show-report"),", click on the trace icon next to the test's file name as seen in the image above. You can then view the trace of your tests and inspect each action to try to find out why the tests are failing."),(0,r.kt)("p",null,(0,r.kt)("img",c({parentName:"p"},{src:"https://github.com/microsoft/playwright/assets/13063165/10fe3585-8401-4051-b1c2-b2e92ac4c274",alt:"playwright trace viewer"}))),(0,r.kt)("h2",c({},{id:"publishing-report-on-the-web"}),"Publishing report on the web"),(0,r.kt)("p",null,"Downloading the HTML report as a zip file is not very convenient. However, we can utilize Azure Storage's static websites hosting capabilities to easily and efficiently serve HTML reports on the Internet, requiring minimal configuration."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create an ",(0,r.kt)("a",c({parentName:"p"},{href:"https://learn.microsoft.com/en-us/azure/storage/common/storage-account-create"}),"Azure Storage account"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enable ",(0,r.kt)("a",c({parentName:"p"},{href:"https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to#enable-static-website-hosting"}),"Static website hosting")," for the storage account.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a Service Principal in Azure and grant it access to Azure Blob storage. Upon successful execution, the command will display the credentials which will be used in the next step."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",c({parentName:"pre"},{className:"language-bash"}),'az ad sp create-for-rbac --name "github-actions" --role "Storage Blob Data Contributor" --scopes /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP_NAME>/providers/Microsoft.Storage/storageAccounts/<STORAGE_ACCOUNT_NAME>\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use the credentials from the previous step to set up encrypted secrets in your GitHub repository. Go to your repository's settings, under ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository"}),"GitHub Actions secrets"),", and add the following secrets:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"AZCOPY_SPA_APPLICATION_ID")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"AZCOPY_SPA_CLIENT_SECRET")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"AZCOPY_TENANT_ID"))),(0,r.kt)("p",{parentName:"li"},"For a detailed guide on how to authorize a service principal using a client secret, refer to ",(0,r.kt)("a",c({parentName:"p"},{href:"https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-authorize-azure-active-directory#authorize-a-service-principal-by-using-a-client-secret-1"}),"this Microsoft documentation"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a step that uploads the HTML report to Azure Storage."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",c({parentName:"pre"},{className:"language-yaml",metastring:'title=".github/workflows/playwright.yml"',title:'".github/workflows/playwright.yml"'}),"...\n    - name: Upload HTML report to Azure\n      shell: bash\n      run: |\n        REPORT_DIR='run-${{ github.run_id }}-${{ github.run_attempt }}'\n        azcopy cp --recursive \"./playwright-report/*\" \"https://<STORAGE_ACCOUNT_NAME>.blob.core.windows.net/\\$web/$REPORT_DIR\"\n        echo \"::notice title=HTML report url::https://<STORAGE_ACCOUNT_NAME>.z1.web.core.windows.net/$REPORT_DIR/index.html\"\n      env:\n        AZCOPY_AUTO_LOGIN_TYPE: SPN\n        AZCOPY_SPA_APPLICATION_ID: '${{ secrets.AZCOPY_SPA_APPLICATION_ID }}'\n        AZCOPY_SPA_CLIENT_SECRET: '${{ secrets.AZCOPY_SPA_CLIENT_SECRET }}'\n        AZCOPY_TENANT_ID: '${{ secrets.AZCOPY_TENANT_ID }}'\n")))),(0,r.kt)("p",null,"The contents of the ",(0,r.kt)("inlineCode",{parentName:"p"},"$web")," storage container can be accessed from a browser by using the ",(0,r.kt)("a",c({parentName:"p"},{href:"https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to?tabs=azure-portal#portal-find-url"}),"public URL")," of the website."),(0,r.kt)("admonition",c({},{type:"note"}),(0,r.kt)("p",{parentName:"admonition"},"This step will not work for pull requests created from a forked repository because such workflow ",(0,r.kt)("a",c({parentName:"p"},{href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets#using-encrypted-secrets-in-a-workflow"}),"doesn't have access to the secrets"),".")),(0,r.kt)("h2",c({},{id:"whats-next"}),"What's Next"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/locators"}),"Learn how to use Locators")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/input"}),"Learn how to perform Actions")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/test-assertions"}),"Learn how to write Assertions")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/trace-viewer"}),"Learn more about the Trace Viewer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",c({parentName:"li"},{href:"/docs/ci"}),"Learn more about running tests on other CI providers"))))}f.isMDXComponent=!0}}]);